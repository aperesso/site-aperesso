{"ast":null,"code":"import _Promise from \"@babel/runtime-corejs2/core-js/promise\";\nimport * as THREE from 'three';\nimport { AUDIO_SETTINGS } from './settings';\n\nconst Audio = function () {\n  const listener = new THREE.AudioListener();\n  const sound = new THREE.Audio(listener);\n\n  const loadFile = async () => {\n    const loader = new THREE.AudioLoader();\n    return new _Promise(resolve => {\n      loader.load(`/assets/audio/${AUDIO_SETTINGS.file}`, buffer => resolve(buffer));\n    });\n  };\n\n  const bufferDecrease = new Array(8).fill(0);\n  const frequencyBandsBuffer = new Array(8).fill(0);\n  const frequencyBands = new Array(8).fill(0);\n  const audioBands = new Array(8).fill(0);\n  const audioBandsBuffer = new Array(8).fill(0);\n  const highestFreq = new Array(8).fill(0);\n\n  const updateFrequencyBands = samples => {\n    let count = 0;\n\n    for (let i in frequencyBands) {\n      let sampleCount = Math.pow(2, i) * 2;\n      if (i === 7) sampleCount += 2;\n      let average = 0;\n\n      for (let j = 0; j < sampleCount; j++) {\n        average += samples[count] * (count + 1);\n        count++;\n      }\n\n      frequencyBands[i] = average / sampleCount * 10;\n    }\n  };\n\n  const updateFrequencyBandsBuffer = () => {\n    for (let i in frequencyBandsBuffer) {\n      if (frequencyBands[i] > frequencyBandsBuffer[i]) {\n        bufferDecrease[i] = 0.005;\n        frequencyBandsBuffer[i] = frequencyBands[i];\n      } else {\n        bufferDecrease[i] *= 1.2;\n        frequencyBandsBuffer[i] -= bufferDecrease[i];\n      }\n    }\n  };\n\n  const updateAudioBands = () => {\n    for (let i in audioBands) {\n      if (frequencyBands[i] > highestFreq[i]) {\n        highestFreq[i] = frequencyBands[i];\n      }\n\n      audioBands[i] = frequencyBands[i] / (highestFreq[i] || 1);\n      audioBandsBuffer[i] = frequencyBandsBuffer[i] / (highestFreq[i] || 1);\n    }\n  };\n\n  this.load = async () => {\n    const buffer = await loadFile();\n    sound.setBuffer(buffer);\n    sound.setLoop(true);\n    this.analyzer = new THREE.AudioAnalyser(sound, AUDIO_SETTINGS.ftSize);\n  };\n\n  this.update = () => {\n    if (!sound.isPlaying) sound.play();\n    const samples = this.analyzer.getFrequencyData();\n    updateFrequencyBands(samples);\n    updateFrequencyBandsBuffer();\n    updateAudioBands();\n  };\n\n  this.getAudioBandsBuffer = () => audioBandsBuffer;\n};\n\nexport default Audio;","map":{"version":3,"sources":["/Users/alexiaperesson/site-aperesso/webgl/utils/audio.js"],"names":["THREE","AUDIO_SETTINGS","Audio","listener","AudioListener","sound","loadFile","loader","AudioLoader","resolve","load","file","buffer","bufferDecrease","Array","fill","frequencyBandsBuffer","frequencyBands","audioBands","audioBandsBuffer","highestFreq","updateFrequencyBands","samples","count","i","sampleCount","Math","pow","average","j","updateFrequencyBandsBuffer","updateAudioBands","setBuffer","setLoop","analyzer","AudioAnalyser","ftSize","update","isPlaying","play","getFrequencyData","getAudioBandsBuffer"],"mappings":"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","sourcesContent":["import * as THREE from 'three';\n\nimport { AUDIO_SETTINGS } from './settings';\n\nconst Audio = function() {\n\n  const listener = new THREE.AudioListener();\n  const sound = new THREE.Audio(listener);\n\n  const loadFile = async () => {\n    const loader = new THREE.AudioLoader();\n    return new Promise(\n      resolve => {\n        loader.load(`/assets/audio/${AUDIO_SETTINGS.file}`,\n          buffer => resolve(buffer)\n        )\n      }\n    )\n  }\n\n  const bufferDecrease = new Array(8).fill(0);\n  const frequencyBandsBuffer = new Array(8).fill(0);\n  const frequencyBands = new Array(8).fill(0);\n  const audioBands = new Array(8).fill(0);\n  const audioBandsBuffer = new Array(8).fill(0);\n  const highestFreq = new Array(8).fill(0);\n\n  const updateFrequencyBands = samples => {\n    let count = 0;\n    for (let i in frequencyBands) {\n      let sampleCount = Math.pow(2, i) * 2;\n      if (i === 7) sampleCount += 2;\n      let average = 0;\n      for (let j = 0; j < sampleCount; j++) {\n        average += samples[count] * (count + 1);\n        count++\n      }\n      frequencyBands[i] = (average / sampleCount) * 10;\n    }\n  }\n\n  const updateFrequencyBandsBuffer = () => {\n    for (let i in frequencyBandsBuffer) {\n      if (frequencyBands[i] > frequencyBandsBuffer[i]) {\n        bufferDecrease[i] = 0.005;\n        frequencyBandsBuffer[i] = frequencyBands[i];\n      } else {\n        bufferDecrease[i] *= 1.2;\n        frequencyBandsBuffer[i] -= bufferDecrease[i];\n      }\n    }\n  }      \n\n  const updateAudioBands = () => {\n    for (let i in audioBands) {\n      if (frequencyBands[i] > highestFreq[i]) {\n        highestFreq[i] = frequencyBands[i]\n      }\n      audioBands[i] = frequencyBands[i] / (highestFreq[i] || 1);\n      audioBandsBuffer[i] = frequencyBandsBuffer [i] / (highestFreq[i] || 1);\n    }\n  }\n\n  this.load = async () => {\n    const buffer = await loadFile();\n    sound.setBuffer(buffer);\n    sound.setLoop(true);\n    this.analyzer = new THREE.AudioAnalyser(sound, AUDIO_SETTINGS.ftSize)\n  }\n\n  this.update = () => {\n    if (!sound.isPlaying) sound.play(); \n    const samples = this.analyzer.getFrequencyData();\n    updateFrequencyBands(samples);\n    updateFrequencyBandsBuffer();\n    updateAudioBands()\n  }\n\n  this.getAudioBandsBuffer = () => audioBandsBuffer;\n\n}\n\nexport default Audio;"]},"metadata":{},"sourceType":"module"}